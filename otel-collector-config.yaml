receivers:
  # OTLP receiver for traces, metrics, and logs from the application
  otlp:
    protocols:
      http:
        endpoint: 0.0.0.0:4318
      grpc:
        endpoint: 0.0.0.0:4317

processors:
  # Batch processor to reduce the number of outgoing requests
  batch:
    timeout: 5s
    send_batch_size: 1000

  # Add resource attributes to identify log sources
  resource:
    attributes:
      - key: deployment.environment
        value: ${env:ENVIRONMENT:-development}
        action: upsert

  # Filter out health check and static file logs
  filter/logs:
    logs:
      exclude:
        match_type: regexp
        bodies:
          - '.*GET /health/.*'
          - '.*GET /static/.*'
          - '.*"GET /health/.*'
          - '.*"GET /static/.*'

exporters:
  # Export to OpenObserve
  otlphttp/openobserve:
    endpoint: ${env:OPENOBSERVE_ENDPOINT}
    headers:
      Authorization: ${env:OPENOBSERVE_AUTH_HEADER}
    tls:
      insecure: true

  # Debug exporter for troubleshooting (optional, comment out in production)
  # debug:
  #   verbosity: detailed
  #   sampling_initial: 5
  #   sampling_thereafter: 200

extensions:
  health_check:
    endpoint: 0.0.0.0:13133

service:
  extensions: [health_check]
  pipelines:
    logs:
      receivers: [otlp]
      processors: [resource, filter/logs, batch]
      exporters: [otlphttp/openobserve]
    traces:
      receivers: [otlp]
      processors: [resource, batch]
      exporters: [otlphttp/openobserve]
    metrics:
      receivers: [otlp]
      processors: [resource, batch]
      exporters: [otlphttp/openobserve]
